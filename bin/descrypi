#!/usr/bin/env python3

"""
Descry Pi

Find Raspberry Pis on the network by examining `arp` responses.
"""

import os
import sys
sys.path.insert(1, os.path.join(sys.path[0], '..'))

import descrypi.arp
import descrypi.ieee_ra
import descrypi.macipsconfig

def print_mac_ips():
  """Main entry point."""

  mac_ip_config = descrypi.macipsconfig.MACIPsConfig()
  mac_ips = descrypi.arp.filter_mac_ips(descrypi.arp.find_mac_ips())
  changes = mac_ip_config.record(mac_ips)

  print("MAC -> IPs of Pis:")
  for mac, ip, new, updated in changes:
    print("%s -> %s %s%s" % (
        mac, ip, ("(new!) " if new else ""), ("updated to %s!" % updated if updated else "")))

if __name__ == '__main__':
  print_mac_ips()
  #print(load_mac_ips())
